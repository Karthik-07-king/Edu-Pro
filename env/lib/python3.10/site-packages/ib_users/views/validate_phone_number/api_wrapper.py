from django_swagger_utils.drf_server.utils.decorator.interface_decorator \
    import validate_decorator
from .validator_class import ValidatorClass


@validate_decorator(validator_class=ValidatorClass)
def api_wrapper(*args, **kwargs):
    request_data = kwargs.get('request_data')
    phone_number = request_data.get('phone_number')
    country_code = request_data.get('country_code')

    from ib_users.interactors.validate_phone_number import ValidatePhoneNumberInteractor
    from ib_users.interactors.DTOs.common_dtos import PhoneNumberDTO
    from ib_users.presenters.validate_phone_number_json_presenter import ValidatePhoneNumberJSONPresenter
    from ib_users.storages import UserAccountsSQLStorage

    phone_number_dto = PhoneNumberDTO(
        country_code=country_code,
        phone_number=phone_number
    )

    storage = UserAccountsSQLStorage()

    interactor = ValidatePhoneNumberInteractor(storage)
    presenter = ValidatePhoneNumberJSONPresenter()

    response = interactor.validate_phone_number_wrapper(
        phone_number_dto, presenter
    )
    return response
