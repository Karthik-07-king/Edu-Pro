from django_swagger_utils.drf_server.utils.decorator.interface_decorator \
    import validate_decorator
from .validator_class import ValidatorClass

from ib_users.interactors.\
    create_user_fingerprint_js_login_device_details_interactor \
    import CreateUserFingerprintJsLoginDeviceDetailsInteractor
from ib_users.storages.fingerprint_js_storage_impl import \
    FingerprintJsStorageImpl
from ib_users.presenters.\
    create_user_fingerprint_js_login_device_details_presenter_impl import \
    CreateUserFingerprintJsLoginDeviceDetailsPresenterImpl
from ib_users.interactors import dtos


@validate_decorator(validator_class=ValidatorClass)
def api_wrapper(*args, **kwargs):
    user_id = kwargs['user_dto'].user_id
    user_id = str(user_id)
    request_data = kwargs['request_data']

    storage = FingerprintJsStorageImpl()
    presenter = CreateUserFingerprintJsLoginDeviceDetailsPresenterImpl()
    interactor = CreateUserFingerprintJsLoginDeviceDetailsInteractor(storage)

    user_request_details_dto = dtos.UserFingerPrintJsLoginDeviceDetailsDTO(
        user_id=user_id,
        request_id=request_data["request_id"],
        device_id=request_data["device_id"])

    response = interactor.\
        create_user_fingerprint_js_login_device_details_wrapper(
            user_request_details_dto, presenter)

    return response
