import json
import logging

from django_swagger_utils.drf_server.exceptions import BadRequest

from ib_users.exceptions.custom_exception_constants import \
    INVALID_FINGERPRINT_JS_WEBHOOK_REQUEST_BODY
from ib_users.services.fingerprint_js_impl import FingerprintJsImpl

logger = logging.getLogger(__name__)


def create_fingerprint_js_webhook_details_view(*args, **kwargs):
    request = args[0]
    try:
        request_payload = json.loads(request.body)
    except Exception as err:
        logger.error(err)
        raise BadRequest(
            message=INVALID_FINGERPRINT_JS_WEBHOOK_REQUEST_BODY[0],
            res_status=INVALID_FINGERPRINT_JS_WEBHOOK_REQUEST_BODY[1])

    logger.info(request_payload)

    service = FingerprintJsImpl()
    response = service.create_fingerprint_js_webhook_details(
        request.headers, request_payload)

    logger.info(response.content)

    return response
