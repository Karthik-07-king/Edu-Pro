import json

from ib_users.exceptions.custom_exception_constants import \
    INVALID_FINGERPRINT_JS_WEBHOOK_CREDENTIALS
from ib_users.validators.base_validator import CustomException


class TestCreateFingerprintJsWebhookDetailsPresenterImpl:

    def test_get_success_response(self):
        from ib_users.presenters.\
            create_fingerprint_js_webhook_details_presenter_impl \
            import CreateFingerprintJsWebhookDetailsPresenterImpl

        presenter = CreateFingerprintJsWebhookDetailsPresenterImpl()

        response = presenter.get_success_response()

        assert response.status_code == 200

    def test_get_custom_exception_response(self):
        from ib_users.presenters.\
            create_fingerprint_js_webhook_details_presenter_impl \
            import CreateFingerprintJsWebhookDetailsPresenterImpl

        presenter = CreateFingerprintJsWebhookDetailsPresenterImpl()
        err = CustomException.from_exception_message_DTO(
            INVALID_FINGERPRINT_JS_WEBHOOK_CREDENTIALS)

        response = presenter.get_custom_exception_response(err)

        response_data = json.loads(response.content)
        assert response_data["response"] == \
               INVALID_FINGERPRINT_JS_WEBHOOK_CREDENTIALS.message
        assert response_data["res_status"] == \
               INVALID_FINGERPRINT_JS_WEBHOOK_CREDENTIALS.code
        assert response_data["http_status_code"] == 400
