import pytest

from ib_users.models import FingerprintJsWebhookDetails, \
    UserFingerprintJsLoginDeviceDetails
from ib_users.storages.fingerprint_js_storage_impl import \
    FingerprintJsStorageImpl
from ib_users.tests.factories.interactor_dtos import \
    FingerprintJsWebhookDetailsDTOFactory, \
    UserFingerPrintJsLoginDeviceDetailsDTOFactory


@pytest.mark.django_db
class TestFingerprintJsStorageImpl:
    def test_create_user_fingerprint_js_login_device_details(self):
        storage = FingerprintJsStorageImpl()
        user_login_device_details_dto = \
            UserFingerPrintJsLoginDeviceDetailsDTOFactory()

        storage.create_user_fingerprint_js_login_device_details(
            user_login_device_details_dto)

        user_login_device_details_obj = UserFingerprintJsLoginDeviceDetails.objects.get(
            request_id=user_login_device_details_dto.request_id)
        assert user_login_device_details_obj.user_id == \
               user_login_device_details_dto.user_id
        assert user_login_device_details_obj.device_id == \
               user_login_device_details_dto.device_id

    def test_create_fingerprint_js_webhook_details(self):
        storage = FingerprintJsStorageImpl()
        webhook_details_dto = FingerprintJsWebhookDetailsDTOFactory()

        storage.create_fingerprint_js_webhook_details(webhook_details_dto)

        webhook_details_obj = FingerprintJsWebhookDetails.objects.get(
            request_id=webhook_details_dto.request_id)
        assert webhook_details_obj.webhook_data == \
               webhook_details_dto.webhook_data
