import requests
from django.conf import settings

from ib_users.interactors.third_party.call_service import CallService


class MSG91CallServiceImpl(CallService):
    def __init__(self, message_template: str):
        self.message_template = message_template

    def request_call(self, country_code, phone_number, otp):
        msg = self.message_template.format(otp=otp)

        to_phone_number = country_code.replace("+", "") + phone_number
        url = "https://api.msg91.com/api/sendVoiceCall.php?authkey={auth_key}&to={to}&message={msg}".format(
            auth_key=settings.MSG91_AUTH_KEY,
            msg=msg,
            to=to_phone_number)
        response = requests.post(url)
        print(response.content)
