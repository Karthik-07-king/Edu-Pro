from ib_users.interactors.storages import UserAccountsStorage
from ib_users.interactors.third_party.otp_service import OTPService
from ib_users.interactors.user_credentials.DTOs.user_credentials_dtos import \
    UserResetPasswordOtpPhoneNumberDTO
from ib_users.validators import PasswordValidator


class VerifyResetPasswordOTPToPhoneNumberInteractor:
    def __init__(self,
                 storage: UserAccountsStorage,
                 otp_service: OTPService):
        self.storage = storage
        self.otp_service = otp_service

    def reset_password_with_otp_phone_number(
            self,
            reset_password_dto: UserResetPasswordOtpPhoneNumberDTO):
        PasswordValidator.validate(reset_password_dto.new_password)
        self.otp_service.validate_otp_send_to_recovery_phone_number(
            phone_number_dto=reset_password_dto,
            otp=reset_password_dto.otp,
            user_id=reset_password_dto.user_id
        )
        self.storage.update_user_password(
            user_id=reset_password_dto.user_id,
            new_password=reset_password_dto.new_password)
