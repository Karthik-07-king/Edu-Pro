from mock import create_autospec

from ib_notifications.interactors.presenters.presenter_interface import \
    PresenterInterface
from ib_notifications.interactors.storages.storage_interface import \
    StorageInterface
from ib_notifications.interactors.unread_notifications_count_interactor import \
    UnreadNotificationsCountInteractor


class TestUnreadNotificationsCountInteractor:

    def test_with_user_id_returns_unread_notifications_count(self):
        user_id = "1"
        unread_notifications_count = 5
        expected_response = {
            "unread_notifications_count": unread_notifications_count
        }

        storage = create_autospec(StorageInterface)
        presenter = create_autospec(PresenterInterface)
        interactor = UnreadNotificationsCountInteractor(storage=storage)

        storage.get_unread_notifications_count.return_value \
            = unread_notifications_count
        presenter.get_unread_notifications_count_response.return_value \
            = expected_response
        response = interactor.get_unread_notifications_count_response(
            user_id=user_id, presenter=presenter)

        storage.get_unread_notifications_count.assert_called_once_with(
            user_id=user_id)
        presenter.get_unread_notifications_count_response \
            .assert_called_once_with(
                unread_notifications_count=unread_notifications_count)
        assert response == expected_response
