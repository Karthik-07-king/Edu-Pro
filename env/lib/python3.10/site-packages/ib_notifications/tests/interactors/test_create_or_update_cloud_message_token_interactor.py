from mock import create_autospec

from ib_notifications.constants.enums import DeviceType
from ib_notifications.interactors.create_or_update_cloud_message_token_interactor import \
    CreateOrUpdateCloudMessageTokenInteractor
from ib_notifications.interactors.storages.storage_interface import \
    StorageInterface


class TestCreateOrUpdateCloudMessageTokenInteractor:
    def test_create_or_update_cloud_message_token_with_valid_inputs(self):
        user_id = "1"
        device_id = "1"
        device_type = DeviceType.WEB.value
        token = "token 1"

        storage_mock = create_autospec(StorageInterface)
        interactor = CreateOrUpdateCloudMessageTokenInteractor(
            storage=storage_mock
        )

        interactor.create_or_update_cloud_message_token_response(
            user_id=user_id,
            device_id=device_id,
            device_type=device_type,
            token=token
        )

        storage_mock.delete_tokens_for_device.assert_called_once_with(
            device_id=device_id, device_type=device_type
        )
        storage_mock.create_cloud_message_token.assert_called_once_with(
            user_id=user_id, device_id=device_id, device_type=device_type,
            token=token
        )
