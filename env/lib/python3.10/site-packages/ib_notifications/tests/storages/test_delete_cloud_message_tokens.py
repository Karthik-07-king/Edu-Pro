import pytest

from ib_notifications.models import UserDeviceToken
from ib_notifications.storages.storage_implementation import \
    StorageImplementation


class TestDeleteCloudMessageTokens:

    @pytest.mark.django_db
    def test_delete_tokens(self, create_user_device_token):
        user_id = "1"
        storage = StorageImplementation()
        previous_user_tokens_count = UserDeviceToken.objects.filter(
            user_id=user_id).count()

        storage.delete_cloud_message_tokens(user_id=user_id)

        assert previous_user_tokens_count == 1
        with pytest.raises(UserDeviceToken.DoesNotExist):
            UserDeviceToken.objects.get(user_id=user_id)
