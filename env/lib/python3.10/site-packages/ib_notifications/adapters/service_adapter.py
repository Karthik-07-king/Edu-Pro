from django.conf import settings

from ib_notifications.services.cloud_messaging_interface import CloudMessagingInterface
from ib_notifications.services.fcm_service_interface import FCMServiceInterface
from ib_notifications.services.one_signal_service_interface import \
    OneSignalServiceInterface


class ServiceAdapter:

    @property
    def cloud_msg_service(self) -> CloudMessagingInterface:
        from ib_notifications.constants.enums import CloudMessagingService

        messaging_service = settings.CLOUD_MESSAGING_SERVICE

        is_one_signal = messaging_service == CloudMessagingService.ONE_SIGNAL.value
        if is_one_signal:
            return OneSignalServiceInterface()

        is_fcm = messaging_service == CloudMessagingService.FCM.value
        if is_fcm:
            from ib_notifications.storages.storage_implementation import StorageImplementation
            return FCMServiceInterface(
                storage=StorageImplementation()
            )


def get_service_adapter():
    return ServiceAdapter()
