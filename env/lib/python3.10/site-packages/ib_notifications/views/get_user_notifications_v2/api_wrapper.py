from django_swagger_utils.drf_server.utils.decorator.interface_decorator \
    import validate_decorator
from .validator_class import ValidatorClass
from ...interactors.dtos import UserNotificationsQueryDTO
from ...interactors.get_user_notifications_v2_interactor import \
    GetUserNotificationsInteractorV2
from ...presenters.user_notifications_presenter_v2 import UserNotificationsPresenterV2
from ...storages.storage_implementation import StorageImplementation
from ...utils.parameter_validator import ParameterValidator


@validate_decorator(validator_class=ValidatorClass)
def api_wrapper(*args, **kwargs):
    user_id = kwargs['user_dto'].user_id
    query_params = kwargs['request_query_params']
    offset = query_params.offset
    limit = query_params.limit
    notification_category = query_params.notifications_category

    parameter_validator = ParameterValidator()
    parameter_validator.validate_limit(limit=limit)
    parameter_validator.validate_offset(offset=offset)

    storage = StorageImplementation()
    presenter = UserNotificationsPresenterV2()
    interactor = GetUserNotificationsInteractorV2(storage=storage)

    query_dto = UserNotificationsQueryDTO(
        user_id=user_id,
        offset=offset,
        limit=limit,
        notification_category=notification_category
    )
    return interactor.get_user_notifications_response(
        query_dto=query_dto,
        presenter=presenter
    )
