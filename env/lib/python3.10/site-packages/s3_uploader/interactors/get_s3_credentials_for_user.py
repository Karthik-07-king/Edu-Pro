from s3_uploader.interactors.dtos import S3CredentialsDTO


class GetS3CredentialForUserInteractor:
    @staticmethod
    def get_s3_credentials(user_id: str):
        from ib_common.date_time_utils.convert_string_to_local_date_time import \
            convert_string_to_local_date_time
        from s3_uploader.constants.constants import DEFAULT_DATETIME_FORMAT
        from s3_uploader.utils.cognito_utils import CognitoUtils

        cognito_utils = CognitoUtils()
        s3_creds = cognito_utils.get_s3_credentials(user_id=user_id)

        expires_on_datetime = convert_string_to_local_date_time(
            s3_creds["expiration"], DEFAULT_DATETIME_FORMAT)
        return S3CredentialsDTO(
            aws_access_key_id=s3_creds["aws_access_key_id"],
            aws_session_token=s3_creds["aws_session_token"],
            bucket_name=s3_creds["bucket_name"],
            cloudfront_domain=s3_creds["cloudfront_domain"],
            expiration=expires_on_datetime,
            folder_name=s3_creds["folder_name"],
            region_name=s3_creds["region_name"],
            secret_access_key=s3_creds["secret_access_key"],
            protocol=s3_creds["protocol"],
            object_acl=s3_creds["object_acl"],
            url_type=s3_creds["url_type"]
        )
